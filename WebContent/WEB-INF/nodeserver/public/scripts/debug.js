$(function(){var socket=io.connect('http://172.27.52.74:3006/');var user={},flg={};init();$('.upload').click(function(){if(flg.upd==0){upd('upload');flg.upd=1}else{upd('');flg.upd=0}});$('#login').click(function(){if($('#huser').text()!='Waiting...'){initub();ub(0);$('#logmsk').fadeIn()}});$('#close').click(function(){$('#logmsk').fadeOut()});$('#logint').click(function(){initub();if(flg.logt==0){ub(1);flg.logt=1}else{ub(0);flg.logt=0}});$("#name").keyup(function(){var len=$('#name').val().length;if(len>13||len==0){$('#name').css('background','rgb(255, 214, 190)');blsp();if(len!=0){$('#nameal').css('color','rgb(255, 57, 19)').text('ID: Too long').fadeIn()}else{$('#nameal').css('color','rgb(255, 57, 19)').text('ID: Null').fadeIn()}flg.name=1}else{$('#name').css('background','rgb(255, 255, 255)');$('#nameal').css('color','rgb(17, 170, 42)').text('ID: Ok').fadeIn();flg.name=0;tcheck()}});$("#pass").keyup(function(){var len=$('#pass').val().length;if(len>10||len==0){$('#pass').css('background','rgb(255, 214, 190)');blsp();if(len!=0){$('#passal').css('color','rgb(255, 57, 19)').text('Password: Too long').fadeIn()}else{$('#passal').css('color','rgb(255, 57, 19)').text('Password: Null').fadeIn()}flg.pass=1}else{$('#pass').css('background','rgb(255, 255, 255)');$('#passal').css('color','rgb(17, 170, 42)').text('Password: Ok').fadeIn();flg.pass=0;tcheck()}});function tcheck(){if(flg.name==0&&flg.pass==0){$('#signupb').css('opacity','1').css('cursor','pointer')}else{blsp()}}$('#signupb').click(function(){$('#sumsk').fadeIn();$('#name, #pass, #logint, #nameal, #passal, #signupb, #edit').css('opacity','0.2');if(flg.name==0&&flg.pass==0){if(flg.logt==0){socket.emit('signup',$('#name').val(),$('#pass').val(),user.name)}else if(flg.logt==1){$('#sumsk').text('Comming Soon...');$('#name, #pass, #logint, #nameal, #passal, #signupb').css('opacity','1');$('#sumsk').fadeOut()}}if($('#signupb').text()=='Delete'){socket.emit('delete',user.name)}});$('#cobolsub').click(function(){if($('#huser').text()=='Waiting...'){alert('Server is Down');location.reload()}else{if($('#huser').text()=='User: Guest'){socket.emit('uploadg',$('#cobols').text(),$('#cobolname').text(),'guest')}else{socket.emit('upload',$('#cobols').text(),$('#cobolname').text(),user.name);$('#sidem').text('')}}});function init(){flg.logt=0;$('#huser').text('Waiting...');if(location.hash=='#upload'){location.hash='upload';$('#cobols, #cobolname').text('');$('.upload').text('Cancel');$('#drop').fadeIn();flg.upd=1}else{flg.upd=0}user.name=localStorage.getItem('user');if(user.name==null){register()}else{search(user.name)}}function register(users){if(users==null){user.name=rand(7);localStorage.setItem('user',user.name);socket.emit('register',user.name)}else{socket.emit('register',users)}}function search(user){socket.emit('search',user)}function rand(n,b){b=b||'';var a='abcdefghijklmnopqrstuvwxyz'+'ABCDEFGHIJKLMNOPQRSTUVWXYZ'+'0123456789'+b;a=a.split('');var s='';for(var i=0;i<n;i++){s+=a[Math.floor(Math.random()*a.length)]}return s};function status(cnt,sta){localStorage.setItem('position',cnt);localStorage.setItem('status',sta);if(sta=='new'){user.status="new"}else{user.status="exi"}}function initub(){flg.name=-1;flg.pass=-1;$('#sumsk').hide();$('#nameal').hide();$('#passal').hide();$('#name, #pass, #logint, #nameal, #passal, #signupb').css('opacity','1');$('#name').css('background','rgb(255, 255, 255)');$('#pass').css('background','rgb(255, 255, 255)');$('#signupb').css('opacity','0.2').css('cursor','default');$('#name, #pass').val('')}function upd(button){location.hash=button;$('#mainbox').text('');if(flg.upd==0){$('#dropa').css('background','none').css('color','#D5D5D5').css('outline','5px dashed #D5D5D5').text('Drop .ccb Here');$('#drop').fadeIn();$('.upload').text('Cancel')}else{$('#drop').fadeOut();$('.upload').text('Upload')}}function ub(flg){if(flg==0){if(user.status=='new'){$('#signup').text('Sign up').css('background','#76ABDB');$('#signupb').text('Sign up').css('opacity','0.2').css('cursor','default');$('#logint').text('Login as an existing user');$('#name').removeAttr('disabled').attr('placeholder','ID').css('border','');$('#pass').show();$('#edit').hide()}else{$('#signup').text('User Information').css('background','#76ABDB');$('#signupb').text('Delete').css('opacity','1').css('cursor','pointer');$('#edit').css('display','inline-block').css('opacity','1');$('#logint').text('Login as another user');$('#name').attr('disabled','disabled').attr('placeholder','ID: '+user.rname).css('border','none');$('#pass').hide()}}else{$('#signup').text('Login').css('background','#FFA622');$('#signupb').text('Login').css('opacity','0.2').css('cursor','default');$('#logint').text('Sign up as a new user');$('#name').removeAttr('disabled').attr('placeholder','ID').css('border','');$('#pass').show();$('#edit').hide()}}function blsp(){$('#signupb').css('opacity','0.2').css('cursor','default')}socket.on('position',function(cnt,sta){status(cnt,sta)});socket.on('nullu',function(){$('#huser').text('User: Guest');register(user.name)});socket.on('new',function(cnt,sta){$('#huser').text('User: Guest')});socket.on('exi',function(name){$('#huser').text('User: '+name);user.rname=name});socket.on('susu',function(name){$('#huser').text('User: '+name);user.rname=name;user.status="registered";$('#sumsk').text('Success');$('#logmsk').fadeOut()});socket.on('delsu',function(){init();$('#sumsk').text('Success');$('#logmsk').fadeOut();$('#sidem').text('');$('#mainbox').text('')});socket.on('suup',function(file){$('#dropa').css('background','none').css('color','#D5D5D5').css('outline','5px dashed #D5D5D5').text('Drop .ccb Here');$('#cobolname, #cobols').text('');alert('"'+file+'" is uploaded.')});socket.on('suop',function(text,file){$('#mainbox').append(text)});flg.cnt=0;var sidefile=[];socket.on('fileresult',function(file,status){if($('#huser').text()!='User: Guest'){flg.cnt2=0;$('#sidem').append('<div class="files files'+flg.cnt+'">'+file+'</div>');$('.files'+flg.cnt).on("click",function(){flg.upd=1;$('.upload').click();$('#mainbox').text('Loading... "'+$(this).text()+'"');socket.emit('open',$(this).text(),user.name)});sidefile.push(file);flg.cnt++}})});