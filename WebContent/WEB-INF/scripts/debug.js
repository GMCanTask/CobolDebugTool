$(function(){var socket=io.connect('http://localhost:3006/');var user={},flg={};init();console.log(location.hash);if(location.hash=='#upload'){location.hash='upload';$('.upload').text('Cancel');$('#drop').fadeIn();flg.upd=1}function init(){flg.upd=0;user.name=localStorage.getItem('user');if(user.name==null){register()}else{search(user.name)}}function register(users){if(users==null){user.name=rand(7);localStorage.setItem('user',user.name);socket.emit('register',user.name)}else{socket.emit('register',users)}}function search(user){socket.emit('search',user)}function rand(n,b){b=b||'';var a='abcdefghijklmnopqrstuvwxyz'+'ABCDEFGHIJKLMNOPQRSTUVWXYZ'+'0123456789'+b;a=a.split('');var s='';for(var i=0;i<n;i++){s+=a[Math.floor(Math.random()*a.length)]}return s};function status(cnt,sta){localStorage.setItem('position',cnt);localStorage.setItem('status',sta)}socket.on('position',function(cnt,sta){status(cnt,sta);if(sta=='new'){$('#huser').text('User: Guest')}else{$('#huser').text('User: '+localStorage.getItem('user'))}});socket.on('nullu',function(){$('#huser').text('User: Guest');register(user.name)});$('.upload').click(function(){if(flg.upd==0){location.hash='upload';$('.upload').text('Cancel');$('#drop').fadeIn();flg.upd=1}else{location.hash='';$('.upload').text('Upload');$('#drop').fadeOut();flg.upd=0}});$('#login').click(function(){$('#name, #pass').val('');$('#logmsk').fadeIn()});$('#close').click(function(){$('#logmsk').fadeOut()})});